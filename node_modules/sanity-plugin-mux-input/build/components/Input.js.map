{"version":3,"sources":["../../src/components/Input.js"],"names":["NOOP","cachedSecrets","token","secretKey","enableSignedUrls","signingKeyId","signingKeyPrivate","validateSecrets","secrets","getSecrets","Promise","resolve","isInitialSetup","needsSetup","then","exists","MuxVideoInput","Component","constructor","props","assetDocument","confirmRemove","deleteOnMuxChecked","deleteAssetDocumentChecked","error","hasFocus","isLoading","isSigned","showSetup","showBrowser","videoReadyToPlay","thumbLoading","handleFocus","setState","state","pollInterval","setInterval","assetId","response","data","client","patch","_id","set","status","commit","returnDocuments","catch","event","prevState","showStetup","result","onChange","PatchEvent","from","asset","_ref","document","setupAssetListener","preventDefault","stopPropagation","unsetAsset","reject","unset","delete","videoPlayer","current","currentTime","getVideoElement","options","time","thumbTime","width","height","fitMode","thumb","playbackId","newThumb","value","setupButton","React","createRef","video","removeVideoButton","componentDidMount","componentWillUnmount","subscription","unsubscribe","clearInterval","getAsset","pipe","handleRemoveVideo","Error","errors","messages","join","static_renditions","pollMux","config","mp4_support","playback_ids","policy","subscribe","renderSetup","handleCancelSaveSetup","handleSaveSetup","renderSetupButton","styles","setupButtonContainer","handleSetupButtonClicked","SetupIcon","renderSetupNotice","backgroundColor","borderRadius","renderAsset","isSignedAlert","handleVideoReadyToPlay","renderVideoButtons","readOnly","handleBrowseButton","handleOpenThumb","handleRemoveVideoButtonClicked","renderBrowser","handleCloseBrowser","handleSelectAsset","renderError","handleErrorClose","message","render","type","level","markers","cssAspectRatio","aspect_ratio","split","studioTheme","position","title","description","formField","blur","focus","handleOnUploadComplete","handleCloseThumbPreview","maxWidth","display","aspectRatio","handleSetThumbButton","handleCancelRemove","handleDeleteOnMuxCheckBoxClicked","margin","handleDeleteAssetDocumentCheckBoxClicked"],"mappings":"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","sourcesContent":["import {\n  Box,\n  Button,\n  Card,\n  Checkbox,\n  Dialog,\n  Flex,\n  Grid,\n  Inline,\n  Stack,\n  studioTheme,\n  Text,\n  ThemeProvider,\n} from '@sanity/ui'\nimport SetupIcon from 'part:@sanity/base/plugin-icon'\nimport {observePaths} from 'part:@sanity/base/preview'\nimport DialogContent from 'part:@sanity/components/dialogs/content'\nimport FullscreenDialog from 'part:@sanity/components/dialogs/fullscreen'\nimport FormField from 'part:@sanity/components/formfields/default'\nimport Spinner from 'part:@sanity/components/loading/spinner'\nimport {withDocument} from 'part:@sanity/form-builder'\nimport PatchEvent, {set, setIfMissing, unset} from 'part:@sanity/form-builder/patch-event'\nimport React, {Component} from 'react'\nimport {of} from 'rxjs'\nimport {tap} from 'rxjs/operators'\nimport {deleteAsset, getAsset} from '../actions/assets'\nimport {fetchSecrets} from '../actions/secrets'\nimport client from '../clients/SanityClient'\nimport getPosterSrc from '../util/getPosterSrc'\nimport styles from './Input.css'\nimport MuxLogo from './MuxLogo'\nimport SelectAsset from './SelectAsset'\nimport Setup from './Setup'\nimport Uploader from './Uploader'\nimport Video from './Video'\nimport config from '../config'\n\nconst NOOP = () => {\n  /* intentional noop */\n}\n\nconst cachedSecrets = {\n  token: null,\n  secretKey: null,\n  enableSignedUrls: false,\n  signingKeyId: null,\n  signingKeyPrivate: null,\n}\n\nfunction validateSecrets(secrets) {\n  if (!secrets.token || !secrets.secretKey) return false\n\n  return true\n}\n\nfunction getSecrets() {\n  if (cachedSecrets.token) {\n    return Promise.resolve({\n      isInitialSetup: true,\n      needsSetup: false,\n      secrets: cachedSecrets,\n    })\n  }\n  return fetchSecrets().then(({secrets, exists}) => {\n    cachedSecrets.token = secrets.token\n    cachedSecrets.secretKey = secrets.secretKey\n    cachedSecrets.enableSignedUrls = secrets.enableSignedUrls\n    cachedSecrets.signingKeyId = secrets.signingKeyId\n    cachedSecrets.signingKeyPrivate = secrets.signingKeyPrivate\n\n    return {\n      isInitialSetup: !exists,\n      needsSetup: !validateSecrets(cachedSecrets),\n      secrets: cachedSecrets,\n    }\n  })\n}\n\nexport default withDocument(\n  class MuxVideoInput extends Component {\n    state = {\n      assetDocument: null,\n      confirmRemove: false,\n      deleteOnMuxChecked: false,\n      deleteAssetDocumentChecked: true,\n      error: null,\n      hasFocus: false,\n      isInitialSetup: true,\n      isLoading: 'secrets',\n      needsSetup: true,\n      secrets: null,\n      isSigned: false,\n      showSetup: false,\n      showBrowser: false,\n      videoReadyToPlay: false,\n      thumbLoading: false,\n    }\n\n    constructor(props) {\n      super(props)\n      getSecrets()\n        .then(({secrets, isInitialSetup, needsSetup}) => {\n          this.setState({\n            secrets,\n            isInitialSetup,\n            needsSetup,\n            isLoading: props.value?.asset, // If there is an asset continue loading\n          })\n        })\n        .catch((error) => this.setState({error}))\n\n      this.setupButton = React.createRef()\n      this.pollInterval = null\n      this.video = React.createRef()\n      this.removeVideoButton = React.createRef()\n      this.videoPlayer = React.createRef()\n    }\n\n    componentDidMount() {\n      this.setupAssetListener()\n    }\n\n    componentWillUnmount() {\n      if (this.subscription) {\n        this.subscription.unsubscribe()\n      }\n      if (this.pollInterval) {\n        clearInterval(this.pollInterval)\n        this.pollInterval = null\n      }\n    }\n\n    focus = () => {\n      this.handleFocus()\n    }\n\n    handleFocus = () => {\n      this.setState({hasFocus: true})\n    }\n\n    handleBlur = () => {\n      this.setState({hasFocus: false})\n    }\n\n    getAsset() {\n      const {value} = this.props\n      return value ? value.asset : null\n    }\n\n    setupAssetListener() {\n      if (this.subscription) {\n        this.subscription.unsubscribe()\n      }\n      this.setState({videoReadyToPlay: false})\n      const asset = this.getAsset()\n      if (!asset) {\n        return\n      }\n      this.subscription = observePaths(asset, [\n        'thumbTime',\n        'data',\n        'assetId',\n        'playbackId',\n        'status',\n      ])\n        .pipe(\n          tap((assetDocument) => {\n            this.setState({assetDocument})\n            if (assetDocument && assetDocument.status === 'errored') {\n              clearInterval(this.pollInterval)\n              this.pollInterval = null\n              // eslint-disable-next-line no-warning-comments\n              // todo: use client.observable\n              return this.handleRemoveVideo().then(() => {\n                this.setState({\n                  isLoading: false,\n                  error: new Error(assetDocument.data.errors.messages.join(' ')),\n                })\n              })\n            }\n            // Poll MUX if it's preparing the main document or its own static renditions\n            if (\n              assetDocument?.status === 'preparing' ||\n              assetDocument?.data?.static_renditions?.status === 'preparing'\n            ) {\n              this.pollMux()\n            }\n            // If MP4 support is enabled: MUX will prepare static_renditions only _after_ an asset\n            // has been successfully uploaded.\n            // A _ready_ asset doesn't mean static mp4s are generated and ready for use!\n            // In these cases, wait for `static_renditions.status === 'ready'` before clearing the poll interval.\n            if (assetDocument && assetDocument.status === 'ready') {\n              switch (config.mp4_support) {\n                case 'standard':\n                  if (assetDocument?.data?.static_renditions?.status === 'ready') {\n                    clearInterval(this.pollInterval)\n                    this.pollInterval = null\n                  }\n                  break\n                case 'none':\n                default:\n                  clearInterval(this.pollInterval)\n                  this.pollInterval = null\n                  break\n              }\n            }\n\n            // eslint-disable-next-line camelcase\n            const isSigned = assetDocument?.data?.playback_ids[0]?.policy === 'signed'\n            this.setState({assetDocument, isSigned, isLoading: false})\n\n            return of(assetDocument)\n          })\n        )\n        .subscribe()\n    }\n\n    pollMux = () => {\n      const assetDocument = this.state.assetDocument\n      if (!assetDocument) {\n        return\n      }\n      if (this.pollInterval) {\n        return\n      }\n      this.pollInterval = setInterval(() => {\n        getAsset(assetDocument.assetId)\n          .then((response) => {\n            const props = response.data\n\n            // TODO: consider a deep comparison on `props` with asset data and only patch only if it's changed\n            client\n              .patch(assetDocument._id)\n              .set({\n                status: props.status,\n                data: props,\n              })\n              .commit({returnDocuments: false})\n          })\n          .catch((error) => {\n            this.setState({error})\n          })\n      }, 2000)\n    }\n\n    handleSetupButtonClicked = (event) => {\n      this.setState((prevState) => ({showSetup: !prevState.showStetup}))\n    }\n\n    handleSaveSetup = ({token, secretKey, enableSignedUrls, signingKeyId, signingKeyPrivate}) => {\n      cachedSecrets.token = token\n      cachedSecrets.secretKey = secretKey\n      cachedSecrets.enableSignedUrls = enableSignedUrls\n      cachedSecrets.signingKeyId = signingKeyId\n      cachedSecrets.signingKeyPrivate = signingKeyPrivate\n\n      this.setState({\n        showSetup: false,\n        secrets: cachedSecrets,\n        needsSetup: !validateSecrets(cachedSecrets),\n      })\n    }\n\n    handleCancelSaveSetup = () => {\n      this.setState({showSetup: false})\n    }\n\n    handleOnUploadComplete = (result) => {\n      const {onChange} = this.props\n      const {_id} = result\n      onChange(\n        PatchEvent.from([setIfMissing({asset: {_ref: _id}}, []), set({_ref: _id}, ['asset'])])\n      )\n      this.setState({assetDocument: result.document}, () => {\n        this.setupAssetListener()\n      })\n    }\n\n    handleRemoveVideoButtonClicked = (event) => {\n      event.preventDefault()\n      event.stopPropagation()\n      this.setState({confirmRemove: true})\n    }\n\n    handleRemoveVideo = () => {\n      const {assetDocument} = this.state\n      this.setState({isLoading: true})\n      const unsetAsset = () => {\n        return new Promise((resolve, reject) => {\n          this.setState(\n            {\n              assetDocument: null,\n              confirmRemove: false,\n              isLoading: false,\n            },\n            () => {\n              if (this.state.deleteOnMuxChecked || this.state.deleteAssetDocumentChecked) {\n                return client\n                  .patch(this.props.document._id)\n                  .unset(['video'])\n                  .commit({returnDocuments: false})\n                  .then(() => {\n                    if (!assetDocument) {\n                      return resolve()\n                    }\n                    return client\n                      .delete(assetDocument._id)\n                      .then(() => {\n                        resolve()\n                      })\n                      .catch((error) => {\n                        reject(error)\n                      })\n                  })\n              }\n              return this.props.onChange(PatchEvent.from(unset()))\n            }\n          )\n        })\n      }\n      return unsetAsset()\n        .then(() => {\n          if (this.state.deleteOnMuxChecked) {\n            return deleteAsset(assetDocument.assetId).catch((error) => {\n              this.setState({error})\n            })\n          }\n          return true\n        })\n        .catch((error) => {\n          this.setState({error})\n        })\n    }\n\n    handleCancelRemove = (event) => {\n      this.setState({\n        confirmRemove: false,\n        deleteOnMuxChecked: true,\n        deleteAssetDocumentChecked: true,\n      })\n    }\n\n    handleDeleteOnMuxCheckBoxClicked = (event) => {\n      this.setState((prevState) => ({\n        deleteOnMuxChecked: !prevState.deleteOnMuxChecked,\n      }))\n    }\n\n    handleDeleteAssetDocumentCheckBoxClicked = (event) => {\n      this.setState((prevState) => ({\n        deleteAssetDocumentChecked: !prevState.deleteAssetDocumentChecked,\n      }))\n    }\n\n    handleOpenThumb = (event) => {\n      if (!this.videoPlayer.current) {\n        return\n      }\n      const {assetDocument, isSigned} = this.state\n      const currentTime = this.videoPlayer.current.getVideoElement().currentTime\n      const options = {\n        time: assetDocument.thumbTime,\n        width: 320,\n        height: 320,\n        fitMode: 'crop',\n        isSigned,\n        signingKeyId: cachedSecrets.signingKeyId,\n        signingKeyPrivate: cachedSecrets.signingKeyPrivate,\n      }\n\n      const thumb = getPosterSrc(assetDocument.playbackId, options)\n      const newThumb = getPosterSrc(assetDocument.playbackId, {...options, time: currentTime})\n\n      this.setState({thumb, newThumb})\n    }\n\n    handleSetThumbButton = (event) => {\n      if (!this.videoPlayer.current) {\n        return\n      }\n\n      this.setState({thumbLoading: true})\n      const {assetDocument, isSigned} = this.state\n      const currentTime = this.videoPlayer.current.getVideoElement().currentTime\n      client\n        .patch(assetDocument._id)\n        .set({\n          thumbTime: currentTime,\n        })\n        .commit({returnDocuments: false})\n        .then((response) => {\n          const options = {\n            time: currentTime,\n            width: 320,\n            height: 320,\n            fitMode: 'crop',\n            isSigned,\n            signingKeyId: cachedSecrets.signingKeyId,\n            signingKeyPrivate: cachedSecrets.signingKeyPrivate,\n          }\n\n          const thumb = getPosterSrc(assetDocument.playbackId, options)\n\n          this.setState({thumb, thumbLoading: false})\n        })\n        .catch((error) => {\n          this.setState({error, thumbLoading: false})\n        })\n    }\n\n    handleErrorClose = (event) => {\n      if (event) {\n        event.preventDefault()\n      }\n\n      this.setState({\n        error: null,\n      })\n    }\n\n    handleCloseThumbPreview = (event) => {\n      this.setState({thumb: null})\n    }\n\n    handleBrowseButton = (event) => {\n      this.setState({showBrowser: true})\n    }\n\n    handleCloseBrowser = (event) => {\n      this.setState({showBrowser: false})\n    }\n\n    handleSelectAsset = (asset) => {\n      const {onChange} = this.props\n\n      onChange(\n        PatchEvent.from([\n          setIfMissing({asset: {_ref: asset._id}}, []),\n          set({_ref: asset._id}, ['asset']),\n        ])\n      )\n\n      this.setState({showBrowser: false, assetDocument: asset}, () => {\n        this.setupAssetListener()\n      })\n    }\n\n    handleVideoReadyToPlay = () => {\n      this.setState({videoReadyToPlay: true})\n    }\n\n    renderSetup() {\n      const {secrets} = this.state\n\n      return (\n        <Dialog\n          header=\"Mux API Credentials\"\n          width={1}\n          onClose={this.handleCancelSaveSetup}\n          zOffset={1000}\n        >\n          <Setup\n            secrets={secrets || null}\n            onSave={this.handleSaveSetup}\n            onCancel={this.handleCancelSaveSetup}\n          />\n        </Dialog>\n      )\n    }\n\n    renderSetupButton() {\n      const {isLoading, showSetup, needsSetup} = this.state\n      const renderSetup = !isLoading && showSetup\n      return (\n        <div className={styles.setupButtonContainer}>\n          <Button\n            tone={needsSetup ? 'critical' : 'positive'}\n            mode=\"bleed\"\n            onClick={this.handleSetupButtonClicked}\n            icon={SetupIcon}\n            padding={3}\n            radius={3}\n            aria-label=\"Set up Mux credentials\"\n          />\n          {renderSetup && this.renderSetup()}\n        </div>\n      )\n    }\n\n    renderSetupNotice() {\n      const {isLoading, isInitialSetup} = this.state\n\n      if (isLoading) {\n        return null\n      }\n\n      return (\n        <Stack padding={4} space={5} style={{backgroundColor: '#efefefef', borderRadius: 3}}>\n          <MuxLogo />\n          <Stack space={4}>\n            {isInitialSetup && (\n              <Text>\n                Looks like this is the first time you are using the Mux video plugin in this\n                dataset. Great!\n              </Text>\n            )}\n            <Text>Before you can upload video, you must set your Mux credentials.</Text>\n            <Text>Click the plugin button in the field title to open Setup.</Text>\n          </Stack>\n        </Stack>\n      )\n    }\n\n    // eslint-disable-next-line complexity\n    renderAsset() {\n      const {assetDocument, isSigned} = this.state\n      const renderAsset = !!assetDocument\n      if (!renderAsset) {\n        return null\n      }\n      const isSignedAlert = isSigned ? (\n        <Card padding={3} radius={2} shadow={1} tone=\"positive\">\n          <Text size={1}>This Mux asset is using a signed url.</Text>\n        </Card>\n      ) : null\n      return (\n        <Stack space={2} marginBottom={2}>\n          {isSignedAlert}\n          <Video\n            assetDocument={assetDocument}\n            ref={this.videoPlayer}\n            onReady={this.handleVideoReadyToPlay}\n            onCancel={this.handleRemoveVideo}\n          />\n        </Stack>\n      )\n    }\n\n    renderVideoButtons() {\n      const {assetDocument, confirmRemove} = this.state\n      const {readOnly} = this.props\n      if (assetDocument && assetDocument.status === 'ready' && !readOnly) {\n        return [\n          <Button\n            key=\"browse\"\n            mode=\"ghost\"\n            tone=\"primary\"\n            onClick={this.handleBrowseButton}\n            text=\"Browse\"\n          />,\n          <Button\n            key=\"thumbnail\"\n            mode=\"ghost\"\n            tone=\"primary\"\n            disabled={this.state.videoReadyToPlay === false}\n            onClick={this.handleOpenThumb}\n            text=\"Thumbnail\"\n          />,\n          <Button\n            key=\"remove\"\n            ref={this.removeVideoButton}\n            onClick={confirmRemove ? NOOP : this.handleRemoveVideoButtonClicked}\n            mode=\"ghost\"\n            tone=\"critical\"\n            text=\"Remove\"\n          />,\n        ]\n      }\n      return null\n    }\n\n    renderBrowser() {\n      return (\n        <FullscreenDialog title=\"Select video\" onClose={this.handleCloseBrowser} isOpen>\n          <SelectAsset onSelect={this.handleSelectAsset} />\n        </FullscreenDialog>\n      )\n    }\n\n    renderError() {\n      const {error} = this.state\n      if (!error) {\n        return null\n      }\n      return (\n        <Dialog header=\"Error\" onClose={this.handleErrorClose}>\n          <DialogContent size=\"small\">{error.message}</DialogContent>\n        </Dialog>\n      )\n    }\n\n    render() {\n      const {type, level, markers} = this.props\n      const {\n        isLoading,\n        secrets,\n        hasFocus,\n        needsSetup,\n        error,\n        showBrowser,\n        confirmRemove,\n        thumb,\n        assetDocument,\n      } = this.state\n\n      const cssAspectRatio = assetDocument?.data?.aspect_ratio?.split(':')?.join('/') || 'auto'\n\n      return (\n        <ThemeProvider theme={studioTheme}>\n          <Box style={{position: 'relative'}}>\n            <Flex align=\"center\" justify=\"space-between\">\n              <FormField\n                label={type.title}\n                markers={markers}\n                description={type.description}\n                level={level}\n                className={styles.formField}\n              />\n              {this.renderSetupButton()}\n            </Flex>\n\n            {isLoading === 'secrets' && (\n              <Box marginBottom={2}>\n                <Inline align=\"center\" space={2}>\n                  <Spinner inline />\n                  <Text size={1}>Fetching credentials</Text>\n                </Inline>\n              </Box>\n            )}\n\n            {needsSetup && this.renderSetupNotice()}\n\n            {!needsSetup && (\n              <Uploader\n                buttons={this.renderVideoButtons()}\n                hasFocus={hasFocus}\n                // eslint-disable-next-line react/jsx-handler-names\n                onBlur={this.blur}\n                // eslint-disable-next-line react/jsx-handler-names\n                onFocus={this.focus}\n                onSetupButtonClicked={this.handleSetupButtonClicked}\n                onUploadComplete={this.handleOnUploadComplete}\n                secrets={secrets}\n                onBrowse={this.handleBrowseButton}\n              >\n                {this.renderAsset()}\n              </Uploader>\n            )}\n\n            {thumb && (\n              <Dialog header=\"Thumbnail\" zOffset={1000} onClose={this.handleCloseThumbPreview}>\n                <Stack space={3} padding={3}>\n                  <Stack space={3}>\n                    <Stack space={2}>\n                      <Text size={1} weight=\"semibold\">\n                        Current:\n                      </Text>\n                      <img\n                        style={{\n                          maxWidth: '100%',\n                          borderRadius: '0.1875rem',\n                          display: 'block',\n                          aspectRatio: cssAspectRatio,\n                        }}\n                        src={this.state.thumb}\n                        width={400}\n                      />\n                    </Stack>\n                    <Stack space={2}>\n                      <Text size={1} weight=\"semibold\">\n                        New:\n                      </Text>\n                      <img\n                        style={{\n                          maxWidth: '100%',\n                          borderRadius: '0.1875rem',\n                          display: 'block',\n                          aspectRatio: cssAspectRatio,\n                        }}\n                        src={this.state.newThumb}\n                        width={400}\n                      />\n                    </Stack>\n                  </Stack>\n                  <Button\n                    key=\"thumbnail\"\n                    mode=\"ghost\"\n                    tone=\"primary\"\n                    disabled={this.state.videoReadyToPlay === false}\n                    onClick={this.handleSetThumbButton}\n                    loading={this.state.thumbLoading}\n                    text=\"Set new thumbnail\"\n                  />\n                </Stack>\n              </Dialog>\n            )}\n\n            {showBrowser && this.renderBrowser()}\n\n            {confirmRemove && (\n              <Dialog header=\"Remove video\" zOffset={1000} onClose={this.handleCancelRemove}>\n                <Box padding={4}>\n                  <Stack space={3}>\n                    <Flex align=\"center\">\n                      <Checkbox\n                        checked={this.state.deleteOnMuxChecked}\n                        onChange={this.handleDeleteOnMuxCheckBoxClicked}\n                      />\n                      <Text style={{margin: '0 10px'}}>Delete asset on Mux</Text>\n                    </Flex>\n                    <Flex align=\"center\">\n                      <Checkbox\n                        disabled={this.state.deleteOnMuxChecked}\n                        checked={\n                          this.state.deleteOnMuxChecked || this.state.deleteAssetDocumentChecked\n                        }\n                        onChange={this.handleDeleteAssetDocumentCheckBoxClicked}\n                      />\n                      <Text style={{margin: '0 10px'}}>Delete video from dataset</Text>\n                    </Flex>\n                    <Grid columns={2} gap={2}>\n                      <Button\n                        mode=\"ghost\"\n                        tone=\"default\"\n                        text=\"Cancel\"\n                        onClick={this.handleCancelRemove}\n                        loading={!!isLoading}\n                      />\n                      <Button\n                        mode=\"default\"\n                        tone=\"critical\"\n                        text=\"Remove\"\n                        onClick={this.handleRemoveVideo}\n                        loading={!!isLoading}\n                      />\n                    </Grid>\n                  </Stack>\n                </Box>\n              </Dialog>\n            )}\n\n            {error && this.renderError()}\n          </Box>\n        </ThemeProvider>\n      )\n    }\n  }\n)\n"],"file":"Input.js"}