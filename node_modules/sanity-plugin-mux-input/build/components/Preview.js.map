{"version":3,"sources":["../../src/components/Preview.js"],"names":["MuxVideoPreview","props","React","useState","undefined","secrets","setSecrets","posterSrc","setPosterSrc","useEffect","then","data","value","status","signingKeyId","signingKeyPrivate","playbackId","playbackIds","id","time","thumbTime","fitMode","width","height","isSigned","policy","styles","poster","backgroundImage","filename","propTypes","PropTypes","object","defaultProps"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;AAEA,IAAMA,eAAe,GAAIC,KAAD,IAAW;AACjC,wBAA8BC,eAAMC,QAAN,CAAeC,SAAf,CAA9B;AAAA;AAAA,MAAOC,OAAP;AAAA,MAAgBC,UAAhB;;AACA,yBAAkCJ,eAAMC,QAAN,CAAeC,SAAf,CAAlC;AAAA;AAAA,MAAOG,SAAP;AAAA,MAAkBC,YAAlB;;AAEAN,iBAAMO,SAAN,CAAgB,MAAM;AACpB,iCAAeC,IAAf,CAAqBC,IAAD,IAAUL,UAAU,CAACK,IAAI,CAACN,OAAN,CAAxC;AACD,GAFD,EAEG,EAFH;;AAIAH,iBAAMO,SAAN,CAAgB,MAAM;AACpB,QAAIR,KAAK,CAACW,KAAN,KAAgB,IAAhB,IAAwBP,OAAO,KAAKD,SAAxC,EAAmD;AAEnD,QAAIH,KAAK,CAACW,KAAN,CAAYC,MAAZ,KAAuB,OAA3B,EAAoC;AAEpC,QAAOC,YAAP,GAA0CT,OAA1C,CAAOS,YAAP;AAAA,QAAqBC,iBAArB,GAA0CV,OAA1C,CAAqBU,iBAArB;AACA,QAAMC,UAAU,GAAGf,KAAK,CAACW,KAAN,CAAYK,WAAZ,CAAwB,CAAxB,CAAnB;AAEAT,IAAAA,YAAY,CACV,2BAAaQ,UAAU,CAACE,EAAxB,EAA4B;AAC1BC,MAAAA,IAAI,EAAElB,KAAK,CAACW,KAAN,CAAYQ,SADQ;AAE1BC,MAAAA,OAAO,EAAE,MAFiB;AAG1BC,MAAAA,KAAK,EAAE,GAHmB;AAI1BC,MAAAA,MAAM,EAAE,GAJkB;AAK1BC,MAAAA,QAAQ,EAAER,UAAU,CAACS,MAAX,KAAsB,QALN;AAM1BX,MAAAA,YAN0B;AAO1BC,MAAAA;AAP0B,KAA5B,CADU,CAAZ;AAWD,GAnBD,EAmBG,CAACd,KAAK,CAACW,KAAP,EAAcP,OAAd,CAnBH;;AAqBA,MAAI,CAACJ,KAAK,CAACW,KAAX,EAAkB,OAAO,IAAP;;AAElB,MAAIL,SAAS,KAAKH,SAAlB,EAA6B;AAC3B,wBAAO;AAAK,MAAA,SAAS,EAAEsB,iBAAOC,MAAvB;AAA+B,MAAA,KAAK,EAAE;AAACC,QAAAA,eAAe,gBAASrB,SAAT;AAAhB;AAAtC,MAAP;AACD;;AAED,qBAAuCN,KAAK,CAACW,KAA7C;AAAA,MAAOiB,QAAP,gBAAOA,QAAP;AAAA,MAAiBb,UAAjB,gBAAiBA,UAAjB;AAAA,MAA6BH,MAA7B,gBAA6BA,MAA7B;AAEA,sBACE,6BAAC,6BAAD;AACE,IAAA,KAAK,EAAEgB,QAAQ,IAAIb,UAAZ,IAA0B,EADnC;AAEE,IAAA,QAAQ,EAAEH,MAAM,qBAAcA,MAAd,IAAyB;AAF3C,IADF;AAMD,CA3CD;;AA6CAb,eAAe,CAAC8B,SAAhB,GAA4B;AAC1BlB,EAAAA,KAAK,EAAEmB,mBAAUC;AADS,CAA5B;AAIAhC,eAAe,CAACiC,YAAhB,GAA+B;AAC7BrB,EAAAA,KAAK,EAAE;AADsB,CAA/B;eAIeZ,e","sourcesContent":["import {SanityDefaultPreview} from 'part:@sanity/base/preview'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport {fetchSecrets} from '../actions/secrets'\nimport getPosterSrc from '../util/getPosterSrc'\nimport styles from './Preview.css'\n\nconst MuxVideoPreview = (props) => {\n  const [secrets, setSecrets] = React.useState(undefined)\n  const [posterSrc, setPosterSrc] = React.useState(undefined)\n\n  React.useEffect(() => {\n    fetchSecrets().then((data) => setSecrets(data.secrets))\n  }, [])\n\n  React.useEffect(() => {\n    if (props.value === null || secrets === undefined) return\n\n    if (props.value.status !== 'ready') return\n\n    const {signingKeyId, signingKeyPrivate} = secrets\n    const playbackId = props.value.playbackIds[0]\n\n    setPosterSrc(\n      getPosterSrc(playbackId.id, {\n        time: props.value.thumbTime,\n        fitMode: 'crop',\n        width: 640,\n        height: 360,\n        isSigned: playbackId.policy === 'signed',\n        signingKeyId,\n        signingKeyPrivate,\n      })\n    )\n  }, [props.value, secrets])\n\n  if (!props.value) return null\n\n  if (posterSrc !== undefined) {\n    return <div className={styles.poster} style={{backgroundImage: `url(${posterSrc})`}} />\n  }\n\n  const {filename, playbackId, status} = props.value\n\n  return (\n    <SanityDefaultPreview\n      title={filename || playbackId || ''}\n      subtitle={status ? `status: ${status}` : null}\n    />\n  )\n}\n\nMuxVideoPreview.propTypes = {\n  value: PropTypes.object,\n}\n\nMuxVideoPreview.defaultProps = {\n  value: null,\n}\n\nexport default MuxVideoPreview\n"],"file":"Preview.js"}