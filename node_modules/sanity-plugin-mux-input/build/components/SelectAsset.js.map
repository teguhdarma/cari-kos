{"version":3,"sources":["../../src/components/SelectAsset.js"],"names":["PER_PAGE","createQuery","start","end","SelectAsset","React","Component","constructor","props","event","preventDefault","select","currentTarget","getAttribute","key","fetchPage","pageNo","imageElm","src","width","height","state","assets","isLastPage","isLoading","secrets","setState","client","fetch","then","result","prevState","length","concat","componentDidMount","id","selected","find","doc","_id","onSelect","render","styles","root","imageList","map","asset","size","posterUrl","playbackId","time","thumbTime","fit_mode","isSigned","data","playback_ids","policy","signingKeyId","signingKeyPrivate","item","handleItemClick","handleItemKeyPress","flexGrow","padder","paddingBottom","handleImageError","image","filename","loadMore","handleFetchNextPage"],"mappings":"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","sourcesContent":["import {Button} from '@sanity/ui'\nimport React from 'react'\nimport {fetchSecrets} from '../actions/secrets'\nimport client from '../clients/SanityClient'\nimport getPosterSrc from '../util/getPosterSrc'\nimport styles from './SelectAsset.css'\n\nconst PER_PAGE = 200\n\nfunction createQuery(start = 0, end = PER_PAGE) {\n  return `*[_type == \"mux.videoAsset\"] | order(_updatedAt desc) [${start}...${end}] {_id, playbackId, thumbTime, data}`\n}\n\nexport default class SelectAsset extends React.Component {\n  pageNo = 0\n\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      assets: [],\n      isLastPage: false,\n      isLoading: false,\n      secrets: null,\n    }\n  }\n\n  fetchPage(pageNo) {\n    const start = pageNo * PER_PAGE\n    const end = start + PER_PAGE\n    this.setState({isLoading: true})\n    return client.fetch(createQuery(start, end)).then((result) => {\n      this.setState((prevState) => ({\n        isLastPage: result.length === 0,\n        assets: prevState.assets.concat(result),\n        isLoading: false,\n      }))\n    })\n  }\n\n  componentDidMount() {\n    this.fetchPage(this.pageNo)\n    fetchSecrets().then(({secrets}) => this.setState({secrets}))\n  }\n\n  select(id) {\n    const selected = this.state.assets.find((doc) => doc._id === id)\n    if (selected) {\n      this.props.onSelect(selected)\n    }\n  }\n\n  handleItemClick = (event) => {\n    event.preventDefault()\n    this.select(event.currentTarget.getAttribute('data-id'))\n  }\n\n  handleItemKeyPress = (event) => {\n    if (event.key === 'Enter') {\n      event.preventDefault()\n      this.select(event.currentTarget.getAttribute('data-id'))\n    }\n  }\n  handleFetchNextPage = () => {\n    this.fetchPage(++this.pageNo)\n  }\n\n  handleImageError = (event) => {\n    const imageElm = event.currentTarget\n    imageElm.src =\n      'data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9JzMwMHB4JyB3aWR0aD0nMzAwcHgnICBmaWxsPSIjMDAwMDAwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2aWV3Qm94PSIwIDAgNDggNDgiIHZlcnNpb249IjEuMSIgeD0iMHB4IiB5PSIwcHgiPjx0aXRsZT5JY29ucyAvIEdlbmVyYWwgLyBMYXJnZSAvIFVua25vd248L3RpdGxlPjxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPjxnIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnPjxwYXRoIGQ9Ik0yOS42MTQ1OTYxLDYuNSBMMzcuNSwxNC4zMjUwNjUgTDM3LjUsMzkuMzI2NDQ0NyBDMzcuNSw0MC41Mjk0ODk3IDM2LjUzMDMzNjYsNDEuNSAzNS4zMjM3MzA1LDQxLjUgTDExLjY3NjI2OTUsNDEuNSBDMTAuNDc0MTY5Niw0MS41IDkuNSw0MC41MjU4OTM3IDkuNSwzOS4zMjM1NjAxIEw5LjUsOC42NzY0Mzk5MiBDOS41LDcuNDc1MjA3OTYgMTAuNDY5NTU4MSw2LjUgMTEuNjU4MDg4Nyw2LjUgTDI5LjYxNDU5NjEsNi41IFoiIHN0cm9rZT0iIzAwMDAwMCI+PC9wYXRoPjxwb2x5Z29uIGZpbGw9IiMwMDAwMDAiIHBvaW50cz0iMjkgOCAzNSAxNCAyOSAxNCI+PC9wb2x5Z29uPjxwYXRoIGQ9Ik0yMS40NTY1NzU5LDI4LjkwMTg1NjggQzIxLjQ1NjU3NTksMjguNTk0MTYyOSAyMS41NjA5NzA4LDI4LjMzNDIxODYgMjEuNzY5NzYzNywyOC4xMjIwMTU5IEMyMS45Nzg1NTY2LDI3LjkwOTgxMzMgMjIuMjMxNzE0MiwyNy44MDM3MTM1IDIyLjUyOTI0NDEsMjcuODAzNzEzNSBDMjIuODI2Nzc0LDI3LjgwMzcxMzUgMjMuMDc5OTMxNiwyNy45MDk4MTMzIDIzLjI4ODcyNDUsMjguMTIyMDE1OSBDMjMuNDk3NTE3NCwyOC4zMzQyMTg2IDIzLjYwMTkxMjMsMjguNTk0MTYyOSAyMy42MDE5MTIzLDI4LjkwMTg1NjggQzIzLjYwMTkxMjMsMjkuMjA5NTUwNiAyMy40OTc1MTc0LDI5LjQ2OTQ5NSAyMy4yODg3MjQ1LDI5LjY4MTY5NzYgQzIzLjA3OTkzMTYsMjkuODkzOTAwMyAyMi44MjY3NzQsMzAgMjIuNTI5MjQ0MSwzMCBDMjIuMjMxNzE0MiwzMCAyMS45Nzg1NTY2LDI5Ljg5MzkwMDMgMjEuNzY5NzYzNywyOS42ODE2OTc2IEMyMS41NjA5NzA4LDI5LjQ2OTQ5NSAyMS40NTY1NzU5LDI5LjIwOTU1MDYgMjEuNDU2NTc1OSwyOC45MDE4NTY4IFogTTIwLjkzOTgxNiwxOC45MDcxNjE4IEMyMS41NzY2MzQ0LDE4LjMwMjM4NDIgMjIuNDI0ODQyOSwxOCAyMy40ODQ0NjY5LDE4IEMyNC41NDQwOTA5LDE4IDI1LjM5NDkwOTMsMTguMjk3MDc5MyAyNi4wMzY5NDc1LDE4Ljg5MTI0NjcgQzI2LjY3ODk4NTcsMTkuNDg1NDE0MSAyNywyMC4zMjYyNTQ1IDI3LDIxLjQxMzc5MzEgQzI3LDIyLjUwMTMzMTcgMjYuNjkyMDM1MSwyMy4yOTQ0MjcyIDI2LjA3NjA5NiwyMy43OTMxMDM0IEMyNS40NjAxNTY5LDI0LjI5MTc3OTcgMjQuNTQ2NzAxNiwyNC41NDY0MTkgMjMuMzM1NzAyNywyNC41NTcwMjkyIEwyMy4zMzU3MDI3LDI2LjQ5ODY3MzcgTDIxLjY0NDQ4ODUsMjYuNDk4NjczNyBMMjEuNjQ0NDg4NSwyMy4zMTU2NDk5IEwyMi4zOTYxMzkzLDIzLjMxNTY0OTkgQzIzLjM3NzQ2NiwyMy4zMjYyNiAyNC4xMDU2MjAzLDIzLjE5NjI4NzggMjQuNTgwNjI0MiwyMi45MjU3Mjk0IEMyNS4wNTU2MjgxLDIyLjY1NTE3MTEgMjUuMjkzMTI2NSwyMi4xMjIwMTk5IDI1LjI5MzEyNjUsMjEuMzI2MjU5OSBDMjUuMjkzMTI2NSwyMC43NjM5MjI5IDI1LjEzMzkyNDMsMjAuMzIzNjA5IDI0LjgxNTUxNTEsMjAuMDA1MzA1IEMyNC40OTcxMDU5LDE5LjY4NzAwMTEgMjQuMDU2MDM3NSwxOS41Mjc4NTE1IDIzLjQ5MjI5NjYsMTkuNTI3ODUxNSBDMjIuOTI4NTU1NywxOS41Mjc4NTE1IDIyLjQ4NDg3NzQsMTkuNjgxNjk2MSAyMi4xNjEyNDg0LDE5Ljk4OTM4OTkgQzIxLjgzNzYxOTQsMjAuMjk3MDgzOCAyMS42NzU4MDczLDIwLjcyNjc4NzcgMjEuNjc1ODA3MywyMS4yNzg1MTQ2IEwyMC4wMDAyNTI2LDIxLjI3ODUxNDYgQzE5Ljk4OTgxMjksMjAuMzAyMzgyNCAyMC4zMDI5OTc2LDE5LjUxMTkzOTQgMjAuOTM5ODE2LDE4LjkwNzE2MTggWiIgZmlsbD0iIzAwMDAwMCI+PC9wYXRoPjwvZz48L2c+PC9zdmc+'\n    imageElm.width = 100\n    imageElm.height = 100\n  }\n\n  render() {\n    const {assets, isLastPage, isLoading, secrets} = this.state\n\n    return (\n      <div className={styles.root}>\n        <div className={styles.imageList}>\n          {assets.map((asset) => {\n            const size = 80\n            const width = 100\n            const height = 100\n            const posterUrl = getPosterSrc(asset.playbackId, {\n              time: asset.thumbTime || 1,\n              // eslint-disable-next-line camelcase\n              fit_mode: 'smartcrop',\n              width: 100,\n              height: 100,\n              isSigned: asset.data && asset.data.playback_ids[0].policy === 'signed',\n              signingKeyId: secrets.signingKeyId || null,\n              signingKeyPrivate: secrets.signingKeyPrivate || null,\n            })\n            return (\n              <a\n                key={asset._id}\n                className={styles.item}\n                data-id={asset._id}\n                onClick={this.handleItemClick}\n                onKeyPress={this.handleItemKeyPress}\n                tabIndex={0}\n                style={{\n                  width: `${(width * size) / height}px`,\n                  flexGrow: `${(width * size) / height}`,\n                }}\n              >\n                <i\n                  className={styles.padder}\n                  style={{paddingBottom: `${(height / width) * 100}%`}}\n                />\n                <img\n                  onError={this.handleImageError}\n                  src={posterUrl}\n                  className={styles.image}\n                  title={asset.filename || asset.playbackId}\n                />\n              </a>\n            )\n          })}\n        </div>\n        <div className={styles.loadMore}>\n          {!isLastPage && (\n            <Button\n              text=\"Load more\"\n              mode=\"ghost\"\n              tone=\"primary\"\n              onClick={this.handleFetchNextPage}\n              loading={isLoading}\n            />\n          )}\n        </div>\n      </div>\n    )\n  }\n}\n"],"file":"SelectAsset.js"}